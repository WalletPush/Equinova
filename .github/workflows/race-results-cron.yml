name: Race Results Cron Job

on:
  schedule:
    # Run every 5 minutes
    - cron: '*/5 * * * *'
  workflow_dispatch: # Allow manual runs

jobs:
  race-results-cron:
    runs-on: ubuntu-latest
    
    steps:
    - name: Run Race Results Scheduler
      run: |
        echo "Starting race results cron job at $(date)"
        
        # Call the race results scheduler
        RESPONSE=$(curl -s -X POST https://zjqojacejstbqmxzstyk.supabase.co/functions/v1/race-results-scheduler \
          -H "Authorization: Bearer ${{ secrets.SUPABASE_SERVICE_ROLE_KEY }}" \
          -H "Content-Type: application/json")
        
        echo "Response: $RESPONSE"
        
        # Check if the response indicates success
        if echo "$RESPONSE" | grep -q '"success":true'; then
          echo "✅ Cron job completed successfully"
        else
          echo "❌ Cron job failed"
          exit 1
        fi
